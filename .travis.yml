language: python

python:
  - "3.5"

services:
  - postgresql

cache:
  pip: true
  apt: true
  directories:
    - $HOME/.nltk_data

before_install:
  - sudo apt-get -qq update
  - sudo apt-get -qq install -y gfortran libfftw3-dev liblapack-dev libopenblas-dev
  - sudo apt-get -qq install -y enchant aspell-es aspell-en aspell-it aspell-fr aspell-de aspell-pt
  - sudo -H -u postgres bash -c 'createuser -s condor-ir'
  - sudo -H -u postgres bash -c 'createdb -E UTF-8 -U condor-ir condor-ir'
  - psql -c 'alter user "condor-ir" with password ''condor-ir'';' -U postgres

install:
  - pip --quiet install .
  - alembic upgrade head

before_script:
  - python -m nltk.downloader snowball_data stopwords

script:
  - python setup.py test
  - condor bibset create 'data/froac/**/*.xml'
  - condor bibset create --isi 'data/isi/**/*.txt'
  - condor model create
  - condor query find
  - condor bibset
  - condor matrix
  - condor ranking
